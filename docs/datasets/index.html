---
layout: archive
title: "AI2D &#124; PennLINC &#124; Shared Data Resources"
---

<br/>

<h1> Shared AI2D Neuroimaging Data Resources </h1>

This resource is a pilot meant to jump-start a broader effort for datasharing at <a href="https://ai2d.med.upenn.edu/">AI2D</a>.
<br><br>
Many labs at Penn use the same large, publicly available neuroimaging datasets. Historically, each lab downloaded, processed, and maintained their own version of the data – resulting in duplicated efforts, wasted computational resources, and inefficient use of storage. The shared neuroimaging data resources provided by AI2D addresses these challenges by providing centralized access to many of the largest and most commonly used neuroimaging datasets. All datasets are curated, processed, and shared using a standardized workflow that includes widely-used tools developed by AI2D labs. The result? Larger scale, lower cost, and faster progress.

<br><br>
<h1> Currently Available Shared Neuroimaging Data Resources </h1>

<p><strong>Note</strong>: The Sample Size and Number of Sessions shown in the table below represent the full dataset. The number of completed sessions for each processing pipeline can be found on each study-specific page.</p>

<style>
.datasets-table {
  width: 100%;
  max-width: 100%;
  margin: 2rem auto 0 auto;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  background: white;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  position: relative;
  --sticky-top-offset: 70px;
}

.datasets-table-container {
  overflow-x: auto;
  border-radius: 12px;
  margin: 0;
  padding: 0;
}

.datasets-table table {
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  min-width: 1200px;
  table-layout: auto;
  border: 2px solid #e8eaff;
  border-radius: 10px;
  margin: 0;
  padding: 0;
}

.datasets-table thead {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.datasets-table th {
  padding: 16px 12px;
  text-align: center;
  font-weight: 600;
  font-size: 14px;
  border: 1px solid #e8eaff;
  position: relative;
  background: inherit;
  white-space: normal;
  word-wrap: break-word;
}

.datasets-table-sticky {
  position: fixed;
  top: var(--sticky-top-offset);
  left: 0;
  z-index: 50;
  pointer-events: none;
  visibility: hidden;
  overflow: hidden;
}

.datasets-table-sticky table {
  margin: 0;
  border-collapse: separate;
  border-spacing: 0;
}

.datasets-table-sticky thead {
  box-shadow: 0 6px 12px rgba(102, 126, 234, 0.35);
}

/* Header color groups */
.datasets-table th.structural {
  background: linear-gradient(135deg, #a8b5ff 0%, #8b9cff 100%);
}

.datasets-table th.functional {
  background: linear-gradient(135deg, #9c88ff 0%, #8b5fff 100%);
}

.datasets-table th.diffusion {
  background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
}

.datasets-table th.fieldmap {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.datasets-table th:first-child {
  text-align: left;
  position: sticky;
  left: 0;
  z-index: 25;
  background: inherit;
}

.datasets-table thead tr:nth-child(2) th:first-child {
  z-index: 24;
}

.datasets-table th a {
  color: white;
  text-decoration: none;
  transition: opacity 0.2s;
}

.datasets-table th a:hover {
  opacity: 0.8;
}

.datasets-table th u {
  text-decoration: none;
  border-bottom: 2px solid white;
}

.datasets-table tbody tr {
  transition: all 0.2s ease;
  border-bottom: 1px solid #f0f0f0;
}

.datasets-table tbody tr:hover {
  background-color: #e8eaff;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.datasets-table td {
  padding: 16px 12px;
  text-align: center;
  border: 1px solid #e8eaff;
  font-size: 14px;
  color: #333;
  white-space: normal;
  word-wrap: break-word;
}

.datasets-table td:first-child {
  text-align: left;
  font-weight: 500;
  position: sticky;
  left: 0;
  z-index: 5;
  background: white;
  border-right: 2px solid #f0f0f0;
}

.datasets-table tbody tr:hover td:first-child {
  background: #e8eaff;
}

.datasets-table td:first-child a {
  color: #667eea;
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s;
}

.datasets-table td:first-child a:hover {
  color: #764ba2;
}

.datasets-table .status-icon {
  font-size: 18px;
  display: inline-block;
  width: 24px;
  height: 24px;
  line-height: 24px;
  border-radius: 50%;
  text-align: center;
}

.datasets-table .status-success {
  background-color: #d4edda;
  color: #155724;
}

.datasets-table .status-error {
  background-color: #f8d7da;
  color: #721c24;
  font-size: 14px;
}

.datasets-table .status-na {
  background-color: #e2e3e5;
  color: #6c757d;
}

.datasets-table td.column-hover,
.datasets-table th.column-hover {
  background-color: #e8eaff !important;
}

.datasets-table thead th.column-hover {
  background: linear-gradient(135deg, #a8b5ff 0%, #9c88ff 100%) !important;
}

.datasets-table thead th.structural.column-hover {
  background: linear-gradient(135deg, #c0c9ff 0%, #a8b5ff 100%) !important;
}

.datasets-table thead th.functional.column-hover {
  background: linear-gradient(135deg, #b4a0ff 0%, #a88fff 100%) !important;
}

.datasets-table thead th.diffusion.column-hover {
  background: linear-gradient(135deg, #9452ff 0%, #8540ed 100%) !important;
}

.datasets-table thead th.fieldmap.column-hover {
  background: linear-gradient(135deg, #7e96ff 0%, #8e5cb2 100%) !important;
}

@media (max-width: 1200px) {
  .datasets-table {
    font-size: 12px;
  }
  
  .datasets-table th,
  .datasets-table td {
    padding: 12px 8px;
  }
}
</style>

<div class="datasets-table">
  <div class="datasets-table-container">
    <table>
      <thead>
        <tr>
          <th rowspan="2">Dataset</th>
          <th rowspan="2">Age Range (y)</th>
          <th rowspan="2">Sample Size</th>
          <th rowspan="2">Number of Sessions</th>
          <th colspan="4">Raw</th>
          <th colspan="8">Processed</th>
        </tr>
        <tr>
          <th class="structural">T1w</th>
          <th class="functional">fMRI</th>
          <th class="diffusion">dMRI</th>
          <th class="fieldmap">fmap</th>
          <th class="structural"><a href="{{ site.baseurl }}/docs/imaging/image_smriprep/"><u>FreeSurfer</u></a></th>
          <th class="structural"><a href="{{ site.baseurl }}/docs/imaging/image_ncdlmuse/"><u>DLMUSE</u></a></th>
          <th class="structural"><u>RAVENS</u></th>
          <th class="structural"><a href="https://github.com/CBICA/NiChart_DLWMLS"><u>DLWMLS</u></a></th>
          <th class="functional"><a href="{{ site.baseurl }}/docs/imaging/image_fmriprep/"><u>fMRIPrep</u></a></th>
          <th class="functional"><a href="{{ site.baseurl }}/docs/imaging/image_xcpd/"><u>XCP&#8209;D</u></a></th>
          <th class="diffusion"><a href="{{ site.baseurl }}/docs/imaging/image_qsiprep/"><u>QSIPrep</u></a></th>
          <th class="diffusion"><a href="{{ site.baseurl }}/docs/imaging/image_qsirecon/"><u>QSIRecon</u></a></th>
        </tr>
      </thead>
      <tbody>
        {% assign dataset_posts = site.posts | where_exp: "post", "post.path contains 'datasets/_posts'" | sort: "title" %}
        {% for dataset in dataset_posts %}
          {% comment %}Get CSV data as fallback only if front matter doesn't have the data{% endcomment %}
          {% assign csv_data = nil %}
          {% if dataset.study_abbr %}
            {% assign csv_rows = site.data.nichart_data_overview | where: "Study_abbr", dataset.study_abbr %}
            {% assign csv_data = csv_rows | first %}
          {% endif %}
          
          <tr>
            <td><a href="{{ dataset.website }}">{{ dataset.title }} {% if dataset.excerpt and dataset.excerpt != dataset.title %}({{ dataset.excerpt }}){% endif %}</a></td>
            <td>
              {% comment %}Prioritize front matter over CSV{% endcomment %}
              {% assign age_range_display = "" %}
              {% if dataset.age_range and dataset.age_range != "" %}
                {% assign age_range_display = dataset.age_range %}
              {% elsif csv_data and csv_data.age_range %}
                {% if csv_data.age_range contains ";" %}
                  {% assign age_parts = csv_data.age_range | split: ";" %}
                  {% assign min_age = 999 %}
                  {% assign max_age = 0 %}
                  {% for part in age_parts %}
                    {% if part contains "=" %}
                      {% assign range_val = part | split: "=" | last %}
                      {% assign ages = range_val | split: "-" %}
                      {% assign low = ages[0] | plus: 0 %}
                      {% assign high = ages[1] | plus: 0 %}
                      {% if low < min_age %}{% assign min_age = low %}{% endif %}
                      {% if high > max_age %}{% assign max_age = high %}{% endif %}
                    {% endif %}
                  {% endfor %}
                  {% if min_age < 999 %}
                    {% assign age_range_display = min_age | append: "-" | append: max_age %}
                  {% endif %}
                {% else %}
                  {% assign age_range_display = csv_data.age_range %}
                {% endif %}
              {% endif %}
              {% if age_range_display != "" %}
                {{ age_range_display }}
              {% else %}
                n/a
              {% endif %}
            </td>
            <td>
              {% comment %}Prioritize front matter over CSV{% endcomment %}
              {% assign sample_size_display = "" %}
              {% if dataset.sample_size and dataset.sample_size != "" %}
                {% assign sample_size_display = dataset.sample_size %}
              {% elsif csv_data and csv_data.N_subject %}
                {% if csv_data.N_subject contains ";" %}
                  {% assign subj_parts = csv_data.N_subject | split: ";" %}
                  {% assign total_subjects = 0 %}
                  {% for part in subj_parts %}
                    {% if part contains "=" %}
                      {% assign count = part | split: "=" | last | plus: 0 %}
                      {% assign total_subjects = total_subjects | plus: count %}
                    {% endif %}
                  {% endfor %}
                  {% if total_subjects > 0 %}
                    {% assign sample_size_display = total_subjects %}
                  {% endif %}
                {% else %}
                  {% assign sample_size_display = csv_data.N_subject %}
                {% endif %}
              {% endif %}
              {% if sample_size_display != "" %}
                {{ sample_size_display }}
              {% else %}
                n/a
              {% endif %}
            </td>
            <td>
              {% comment %}Prioritize front matter over CSV{% endcomment %}
              {% assign sessions_display = "" %}
              {% if dataset.number_of_sessions and dataset.number_of_sessions != "" %}
                {% assign sessions_display = dataset.number_of_sessions %}
              {% elsif csv_data and csv_data.N_MR_session %}
                {% if csv_data.N_MR_session contains ";" %}
                  {% assign sess_parts = csv_data.N_MR_session | split: ";" %}
                  {% assign total_sessions = 0 %}
                  {% for part in sess_parts %}
                    {% if part contains "=" %}
                      {% assign count = part | split: "=" | last | plus: 0 %}
                      {% assign total_sessions = total_sessions | plus: count %}
                    {% endif %}
                  {% endfor %}
                  {% if total_sessions > 0 %}
                    {% assign sessions_display = total_sessions %}
                  {% endif %}
                {% else %}
                  {% assign sessions_display = csv_data.N_MR_session %}
                {% endif %}
              {% endif %}
              {% if sessions_display != "" %}
                {{ sessions_display }}
              {% else %}
                n/a
              {% endif %}
            </td>
            <td>
              {% comment %}Prioritize front matter over CSV - handle both "Yes"/"No" strings and true/false booleans{% endcomment %}
              {% assign t1w_available = false %}
              {% if dataset.t1w == true or dataset.t1w == "Yes" or dataset.t1w == "yes" %}
                {% assign t1w_available = true %}
              {% elsif dataset.t1w == false or dataset.t1w == "No" or dataset.t1w == "no" %}
                {% assign t1w_available = false %}
              {% elsif csv_data and csv_data.T1w_avai %}
                {% if csv_data.T1w_avai == "Yes" %}
                  {% assign t1w_available = true %}
                {% endif %}
              {% endif %}
              {% if t1w_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Prioritize front matter over CSV{% endcomment %}
              {% assign fmri_available = false %}
              {% if dataset.fmri == true or dataset.fmri == "Yes" or dataset.fmri == "yes" %}
                {% assign fmri_available = true %}
              {% elsif dataset.fmri == false or dataset.fmri == "No" or dataset.fmri == "no" %}
                {% assign fmri_available = false %}
              {% elsif csv_data and csv_data.fmri_avai %}
                {% if csv_data.fmri_avai == "Yes" %}
                  {% assign fmri_available = true %}
                {% endif %}
              {% endif %}
              {% if fmri_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Prioritize front matter over CSV{% endcomment %}
              {% assign dmri_available = false %}
              {% if dataset.dmri == true or dataset.dmri == "Yes" or dataset.dmri == "yes" %}
                {% assign dmri_available = true %}
              {% elsif dataset.dmri == false or dataset.dmri == "No" or dataset.dmri == "no" %}
                {% assign dmri_available = false %}
              {% elsif csv_data and csv_data.dmri_avai %}
                {% if csv_data.dmri_avai == "Yes" %}
                  {% assign dmri_available = true %}
                {% endif %}
              {% endif %}
              {% if dmri_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Prioritize front matter over CSV{% endcomment %}
              {% assign fmap_available = false %}
              {% if dataset.fmap == true or dataset.fmap == "Yes" or dataset.fmap == "yes" %}
                {% assign fmap_available = true %}
              {% elsif dataset.fmap == false or dataset.fmap == "No" or dataset.fmap == "no" %}
                {% assign fmap_available = false %}
              {% elsif csv_data and csv_data.fmap_avai %}
                {% if csv_data.fmap_avai == "Yes" %}
                  {% assign fmap_available = true %}
                {% endif %}
              {% endif %}
              {% if fmap_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for FreeSurfer availability from front matter{% endcomment %}
              {% assign freesurfer_available = false %}
              {% if dataset.smriprep_session and dataset.smriprep_session != "n/a" and dataset.smriprep_session != "" and dataset.smriprep_session != nil %}
                {% assign freesurfer_available = true %}
              {% elsif dataset.freesurfer_session and dataset.freesurfer_session != "n/a" and dataset.freesurfer_session != "" and dataset.freesurfer_session != nil %}
                {% assign freesurfer_available = true %}
              {% elsif dataset.freesurferpost_session and dataset.freesurferpost_session != "n/a" and dataset.freesurferpost_session != "" and dataset.freesurferpost_session != nil %}
                {% assign freesurfer_available = true %}
              {% endif %}
              {% if freesurfer_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for DLMUSE availability from front matter first{% endcomment %}
              {% assign dlmuse_available = false %}
              {% if dataset.ncdlmuse_session and dataset.ncdlmuse_session != "n/a" and dataset.ncdlmuse_session != "" and dataset.ncdlmuse_session != nil %}
                {% assign dlmuse_available = true %}
              {% elsif dataset.dlmuse_session and dataset.dlmuse_session != "n/a" and dataset.dlmuse_session != "" and dataset.dlmuse_session != nil %}
                {% assign dlmuse_available = true %}
              {% elsif csv_data and csv_data.DLMUSE and csv_data.DLMUSE != "" %}
                {% assign dlmuse_available = true %}
              {% elsif csv_data and csv_data.DLMUSE_N_ses_completed and csv_data.DLMUSE_N_ses_completed != "" %}
                {% if csv_data.DLMUSE_N_ses_completed contains ";" %}
                  {% assign parts = csv_data.DLMUSE_N_ses_completed | split: ";" %}
                  {% for part in parts %}
                    {% if part contains "=" %}
                      {% assign count = part | split: "=" | last | plus: 0 %}
                      {% if count > 0 %}{% assign dlmuse_available = true %}{% endif %}
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {% assign count = csv_data.DLMUSE_N_ses_completed | plus: 0 %}
                  {% if count > 0 %}{% assign dlmuse_available = true %}{% endif %}
                {% endif %}
              {% endif %}
              {% if dlmuse_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for RAVENS availability from front matter first{% endcomment %}
              {% assign ravens_available = false %}
              {% if dataset.ravens_session and dataset.ravens_session != "n/a" and dataset.ravens_session != "" and dataset.ravens_session != nil %}
                {% assign ravens_available = true %}
              {% elsif csv_data and csv_data.RAVENS and csv_data.RAVENS != "" %}
                {% assign ravens_available = true %}
              {% elsif csv_data and csv_data.RAVENS_N_ses_completed and csv_data.RAVENS_N_ses_completed != "" %}
                {% if csv_data.RAVENS_N_ses_completed contains ";" %}
                  {% assign parts = csv_data.RAVENS_N_ses_completed | split: ";" %}
                  {% for part in parts %}
                    {% if part contains "=" %}
                      {% assign count = part | split: "=" | last | plus: 0 %}
                      {% if count > 0 %}{% assign ravens_available = true %}{% endif %}
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {% assign count = csv_data.RAVENS_N_ses_completed | plus: 0 %}
                  {% if count > 0 %}{% assign ravens_available = true %}{% endif %}
                {% endif %}
              {% endif %}
              {% if ravens_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for DLWMLS availability from front matter first{% endcomment %}
              {% assign dlwmls_available = false %}
              {% if dataset.dlwmls_session and dataset.dlwmls_session != "n/a" and dataset.dlwmls_session != "" and dataset.dlwmls_session != nil %}
                {% assign dlwmls_available = true %}
              {% elsif csv_data and csv_data.DLWMLS and csv_data.DLWMLS != "" %}
                {% assign dlwmls_available = true %}
              {% elsif csv_data and csv_data.DLWMLS_N_ses_completed and csv_data.DLWMLS_N_ses_completed != "" %}
                {% if csv_data.DLWMLS_N_ses_completed contains ";" %}
                  {% assign parts = csv_data.DLWMLS_N_ses_completed | split: ";" %}
                  {% for part in parts %}
                    {% if part contains "=" %}
                      {% assign count = part | split: "=" | last | plus: 0 %}
                      {% if count > 0 %}{% assign dlwmls_available = true %}{% endif %}
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {% assign count = csv_data.DLWMLS_N_ses_completed | plus: 0 %}
                  {% if count > 0 %}{% assign dlwmls_available = true %}{% endif %}
                {% endif %}
              {% endif %}
              {% if dlwmls_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for fMRIPrep availability from front matter first{% endcomment %}
              {% assign fmriprep_available = false %}
              {% if dataset.fmriprep_session and dataset.fmriprep_session != "n/a" and dataset.fmriprep_session != "" and dataset.fmriprep_session != nil %}
                {% assign fmriprep_available = true %}
              {% elsif csv_data and csv_data.fMRIPrep and csv_data.fMRIPrep != "" %}
                {% assign fmriprep_available = true %}
              {% elsif csv_data and csv_data.fMRIPrep_N_ses_completed and csv_data.fMRIPrep_N_ses_completed != "" %}
                {% if csv_data.fMRIPrep_N_ses_completed contains ";" %}
                  {% assign parts = csv_data.fMRIPrep_N_ses_completed | split: ";" %}
                  {% for part in parts %}
                    {% if part contains "=" %}
                      {% assign count = part | split: "=" | last | plus: 0 %}
                      {% if count > 0 %}{% assign fmriprep_available = true %}{% endif %}
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {% assign count = csv_data.fMRIPrep_N_ses_completed | plus: 0 %}
                  {% if count > 0 %}{% assign fmriprep_available = true %}{% endif %}
                {% endif %}
              {% endif %}
              {% if fmriprep_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for XCP-D availability from front matter first{% endcomment %}
              {% assign xcpd_available = false %}
              {% if dataset.xcpd_session and dataset.xcpd_session != "n/a" and dataset.xcpd_session != "" and dataset.xcpd_session != nil %}
                {% assign xcpd_available = true %}
              {% elsif csv_data and csv_data["XCP-D"] and csv_data["XCP-D"] != "" %}
                {% assign xcpd_available = true %}
              {% elsif csv_data and csv_data["XCP-D_N_ses_completed"] and csv_data["XCP-D_N_ses_completed"] != "" %}
                {% if csv_data["XCP-D_N_ses_completed"] contains ";" %}
                  {% assign parts = csv_data["XCP-D_N_ses_completed"] | split: ";" %}
                  {% for part in parts %}
                    {% if part contains "=" %}
                      {% assign count = part | split: "=" | last | plus: 0 %}
                      {% if count > 0 %}{% assign xcpd_available = true %}{% endif %}
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {% assign count = csv_data["XCP-D_N_ses_completed"] | plus: 0 %}
                  {% if count > 0 %}{% assign xcpd_available = true %}{% endif %}
                {% endif %}
              {% endif %}
              {% if xcpd_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for QSIPrep availability from front matter{% endcomment %}
              {% assign qsiprep_available = false %}
              {% if dataset.qsiprep_session and dataset.qsiprep_session != "n/a" and dataset.qsiprep_session != "" and dataset.qsiprep_session != nil %}
                {% assign qsiprep_available = true %}
              {% endif %}
              {% if qsiprep_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
            <td>
              {% comment %}Check for QSIRecon availability from front matter{% endcomment %}
              {% assign qsirecon_available = false %}
              {% if dataset.qsirecon_session and dataset.qsirecon_session != "n/a" and dataset.qsirecon_session != "" and dataset.qsirecon_session != nil %}
                {% assign qsirecon_available = true %}
              {% endif %}
              {% if dataset.qsirecon_bundle_session and dataset.qsirecon_bundle_session != "n/a" and dataset.qsirecon_bundle_session != "" and dataset.qsirecon_bundle_session != nil %}
                {% assign qsirecon_available = true %}
              {% endif %}
              {% if qsirecon_available %}
                <span class="status-icon status-success">✅</span>
              {% else %}
                <span class="status-icon status-error">NA</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<br>
<p>
NA = Not Available
<br>
✅ = Available
</p>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const table = document.querySelector('.datasets-table table');
  if (!table) return;
  
  const cells = table.querySelectorAll('td, th');
  
  cells.forEach(cell => {
    cell.addEventListener('mouseenter', function() {
      const cellIndex = Array.from(this.parentElement.children).indexOf(this);
      
      // Highlight all cells in the same column
      const rows = table.querySelectorAll('tr');
      rows.forEach(row => {
        const cellInColumn = row.children[cellIndex];
        if (cellInColumn) {
          cellInColumn.classList.add('column-hover');
        }
      });
    });
    
    cell.addEventListener('mouseleave', function() {
      const cellIndex = Array.from(this.parentElement.children).indexOf(this);
      
      // Remove highlight from all cells in the column
      const rows = table.querySelectorAll('tr');
      rows.forEach(row => {
        const cellInColumn = row.children[cellIndex];
        if (cellInColumn) {
          cellInColumn.classList.remove('column-hover');
        }
      });
    });
  });

  const container = document.querySelector('.datasets-table-container');
  const thead = table.querySelector('thead');
  if (!container || !thead) return;

  const stickyWrap = document.createElement('div');
  stickyWrap.className = 'datasets-table datasets-table-sticky';
  const stickyTable = document.createElement('table');
  stickyTable.appendChild(thead.cloneNode(true));
  stickyWrap.appendChild(stickyTable);
  document.body.appendChild(stickyWrap);

  const stickyTopOffset = () => {
    const raw = getComputedStyle(table.closest('.datasets-table')).getPropertyValue('--sticky-top-offset');
    const val = parseFloat(raw);
    return Number.isFinite(val) ? val : 0;
  };

  const syncSticky = () => {
    const tableRect = table.getBoundingClientRect();
    const containerRect = container.getBoundingClientRect();
    const headHeight = thead.getBoundingClientRect().height;
    const offset = stickyTopOffset();

    const show = tableRect.top < offset && tableRect.bottom > offset + headHeight;
    stickyWrap.style.visibility = show ? 'visible' : 'hidden';
    if (!show) return;

    stickyWrap.style.left = `${containerRect.left}px`;
    stickyWrap.style.width = `${containerRect.width}px`;
    stickyTable.style.width = `${tableRect.width}px`;
    stickyTable.style.transform = `translateX(${-container.scrollLeft}px)`;

    const sourceHeaders = table.querySelectorAll('thead th');
    const stickyHeaders = stickyTable.querySelectorAll('thead th');
    const theadStyles = getComputedStyle(thead);
    const theadBgImage = theadStyles.backgroundImage;
    const theadBgColor = theadStyles.backgroundColor;
    sourceHeaders.forEach((th, idx) => {
      if (!stickyHeaders[idx]) return;
      const rect = th.getBoundingClientRect();
      const styles = getComputedStyle(th);
      const bgImage = styles.backgroundImage;
      const bgColor = styles.backgroundColor;
      const isTransparent =
        bgColor === 'transparent' ||
        bgColor === 'rgba(0, 0, 0, 0)' ||
        bgColor === 'rgba(0,0,0,0)';

      stickyHeaders[idx].style.width = `${rect.width}px`;

      if (bgImage && bgImage !== 'none') {
        stickyHeaders[idx].style.backgroundImage = bgImage;
        stickyHeaders[idx].style.backgroundColor = bgColor;
        stickyHeaders[idx].style.backgroundSize = styles.backgroundSize;
        stickyHeaders[idx].style.backgroundPosition = styles.backgroundPosition;
        stickyHeaders[idx].style.backgroundRepeat = styles.backgroundRepeat;
      } else if (!isTransparent) {
        stickyHeaders[idx].style.backgroundImage = 'none';
        stickyHeaders[idx].style.backgroundColor = bgColor;
        stickyHeaders[idx].style.backgroundSize = '';
        stickyHeaders[idx].style.backgroundPosition = '';
        stickyHeaders[idx].style.backgroundRepeat = '';
      } else {
        stickyHeaders[idx].style.backgroundImage = theadBgImage;
        stickyHeaders[idx].style.backgroundColor = theadBgColor;
        stickyHeaders[idx].style.backgroundSize = '';
        stickyHeaders[idx].style.backgroundPosition = '';
        stickyHeaders[idx].style.backgroundRepeat = '';
      }

      stickyHeaders[idx].style.color = styles.color;
      stickyHeaders[idx].style.borderColor = styles.borderColor;
    });
  };

  const scheduleSync = () => window.requestAnimationFrame(syncSticky);
  window.addEventListener('scroll', scheduleSync, { passive: true });
  window.addEventListener('resize', scheduleSync);
  container.addEventListener('scroll', scheduleSync, { passive: true });
  scheduleSync();
});
</script>