---
title: "Functional Data Analysis"
excerpt: "Functional Data Analysis"
layout: single

---

<style>
details p { margin: 8px 0 !important; }
details div { line-height: 1.6; }
</style>

<div style="text-align: center;">
     <img src="{{ site.baseurl }}/assets/images/misc/xcpd_workflow.png" width="70%" height="auto" />
</div>

<br/>
<div style="margin: 10px 0;">
<strong>Citation</strong><br/>
Mehta, Kahini, Taylor Salo, Thomas J Madison, Azeez Adebimpe, Danielle S Bassett, Max Bertolero, Matthew Cieslak, et al. 2024. "XCP-D: A Robust Pipeline for the Post-Processing of fMRI Data." Imaging Neuroscience 2. MIT Press: 1–26. https://doi.org/10.1162/imag_a_00257.
</div>

<details style="margin: 10px 0;">
<summary><strong>More citations (Click to expand/minimize)</strong></summary>
<div style="padding: 10px 0; line-height: 1.6;">
Abraham, Alexandre, Fabian Pedregosa, Michael Eickenberg, Philippe Gervais, Andreas Mueller, Jean Kossaifi, Alexandre Gramfort, Bertrand Thirion, and Gaël Varoquaux. 2014. “Machine Learning for Neuroimaging with Scikit-Learn.” Frontiers in Neuroinformatics. Frontiers, 14.
<p style="margin: 2px 0;"></p>
Avants, Brian B, Nick Tustison, Gang Song, and others. 2009. “Advanced Normalization Tools (Ants).” Insight J 2 (365): 1–35.
<p style="margin: 2px 0;"></p>
Brett, Matthew, Christopher J. Markiewicz, Michael Hanke, Marc-Alexandre Côté, Ben Cipollini, Paul McCarthy, Dorota Jarecka, et al. 2022. Nipy/Nibabel: (version 4.0.0). Zenodo. https://doi.org/10.5281/zenodo.591597.
<p style="margin: 2px 0;"></p>
Ciric, Rastko, Adon F. G. Rosen, Guray Erus, Matthew Cieslak, Azeez Adebimpe, Philip A. Cook, Danielle S. Bassett, Christos Davatzikos, Daniel H. Wolf, and Theodore D. Satterthwaite. 2018. “Mitigating Head Motion Artifact in Functional Connectivity MRI.” Nature Protocols 13 (12): 2801–26. https://doi.org/10.1038/s41596-018-0065-y.
<p style="margin: 2px 0;"></p>
Ciric, Rastko, William H Thompson, Romy Lorenz, Mathias Goncalves, Eilidh MacNicol, Christopher J Markiewicz, Yaroslav O Halchenko, et al. 2022. “TemplateFlow: FAIR-Sharing of Multi-Scale, Multi-Species Brain Models.” bioRxiv. Cold Spring Harbor Laboratory, 2021–02. https://doi.org/10.1101/2021.02.10.430678.
<p style="margin: 2px 0;"></p>
Ciric, Rastko, Daniel H. Wolf, Jonathan D. Power, David R. Roalf, Graham Baum, Kosha Ruparel, Russell T. Shinohara, et al. 2017. “Benchmarking of Participant-Level Confound Regression Strategies for the Control of Motion Artifact in Studies of Functional Connectivity.” NeuroImage 154 (July): 174–87. https://doi.org/10.1016/j.neuroimage.2017.03.020.
<p style="margin: 2px 0;"></p>
Cox, Robert W. 1996. “AFNI: Software for Analysis and Visualization of Functional Magnetic Resonance Neuroimages.” Computers and Biomedical Research 29 (3). Elsevier: 162–73.
<p style="margin: 2px 0;"></p>
Cox, Robert W, and James S Hyde. 1997. “Software Tools for Analysis and Visualization of fMRI Data.” NMR in Biomedicine: An International Journal Devoted to the Development and Application of Magnetic Resonance in Vivo 10 (4-5). Wiley Online Library: 171–78.
<p style="margin: 2px 0;"></p>
Esteban, Oscar, Rastko Ciric, Karolina Finc, Ross W Blair, Christopher J Markiewicz, Craig A Moodie, James D Kent, et al. 2020. “Analysis of Task-Based Functional Mri Data Preprocessed with fMRIPrep.” Nature Protocols 15 (7). Nature Publishing Group: 2186–2202. https://doi.org/10.1038/s41596-020-0327-3.
<p style="margin: 2px 0;"></p>
Esteban, Oscar, Christopher J Markiewicz, Ross W Blair, Craig A Moodie, A Ilkay Isik, Asier Erramuzpe, James D Kent, et al. 2019. “FMRIPrep: A Robust Preprocessing Pipeline for Functional Mri.” Nature Methods 16 (1). Nature Publishing Group: 111–16. https://doi.org/10.1038/s41592-018-0235-4.
<p style="margin: 2px 0;"></p>
Glasser, Matthew F., Timothy S. Coalson, Emma C. Robinson, Carl D. Hacker, John Harwell, Essa Yacoub, Kamil Ugurbil, et al. 2016. “A Multi-Modal Parcellation of Human Cerebral Cortex.” Nature 536 (7615): 171–78. https://doi.org/10.1038/nature18933.
<p style="margin: 2px 0;"></p>
Glasser, Matthew F., Stamatios N. Sotiropoulos, J. Anthony Wilson, Timothy S. Coalson, Bruce Fischl, Jesper L. Andersson, Junqian Xu, et al. 2013. “The Minimal Preprocessing Pipelines for the Human Connectome Project.” NeuroImage 80 (October): 105–24. https://doi.org/10.1016/j.neuroimage.2013.04.127.
<p style="margin: 2px 0;"></p>
Gordon, Evan M., Timothy O. Laumann, Babatunde Adeyemo, Jeremy F. Huckins, William M. Kelley, and Steven E. Petersen. 2016. “Generation and Evaluation of a Cortical Area Parcellation from Resting-State Correlations.” Cerebral Cortex 26 (1): 288–303. https://doi.org/10.1093/cercor/bhu239.
<p style="margin: 2px 0;"></p>
Gorgolewski, Krzysztof, Christopher D. Burns, Cindee Madison, Dav Clark, Yaroslav O. Halchenko, Michael L. Waskom, and Satrajit S. Ghosh. 2011. “Nipype: A Flexible, Lightweight and Extensible Neuroimaging Data Processing Framework in Python.” Frontiers in Neuroinformatics 5. https://doi.org/10.3389/fninf.2011.00013.
<p style="margin: 2px 0;"></p>
Harris, Charles R., Jarrod K. Millman, Stéfan J. van der Walt, Ralf Gommers, Pauli Virtanen, David Cournapeau, Eric Wieser, et al. 2020. “Array Programming with NumPy.” Nature 585 (7825): 357–62. https://doi.org/10.1038/s41586-020-2649-2.
<p style="margin: 2px 0;"></p>
Hermosillo, Robert JM, Lucille A Moore, Eric Fezcko, Ally Dworetsky, Adam Pines, Gregory Conan, Michael A Mooney, et al. 2022. “A Precision Functional Atlas of Network Probabilities and Individual-Specific Network Topography.” bioRxiv. Cold Spring Harbor Laboratory, 2022–01. https://doi.org/10.1101/2022.01.12.475422.
<p style="margin: 2px 0;"></p>
Hunter, John D. 2007. “Matplotlib: A 2D Graphics Environment.” Computing in Science & Engineering 9 (03). IEEE Computer Society: 90–95.
<p style="margin: 2px 0;"></p>
Jiang, Lili, and Xi-Nian Zuo. 2016. “Regional Homogeneity: A Multimodal, Multiscale Neuroimaging Marker of the Human Connectome.” The Neuroscientist 22 (5). Sage Publications Sage CA: Los Angeles, CA: 486–505.
<p style="margin: 2px 0;"></p>
King, Maedbh, Carlos R Hernandez-Castillo, Russell A Poldrack, Richard B Ivry, and Jörn Diedrichsen. 2019. “Functional Boundaries in the Human Cerebellum Revealed by a Multi-Domain Task Battery.” Nature Neuroscience 22 (8). Nature Publishing Group US New York: 1371–8. https://doi.org/10.1038/s41593-019-0436-x.
<p style="margin: 2px 0;"></p>
Marcus, Daniel S, John Harwell, Timothy Olsen, Michael Hodge, Matthew F Glasser, Fred Prior, Mark Jenkinson, Timothy Laumann, Sandra W Curtiss, and David C Van Essen. 2011. “Informatics and Data Mining Tools and Strategies for the Human Connectome Project.” Frontiers in Neuroinformatics 5. Frontiers Research Foundation: 4.
<p style="margin: 2px 0;"></p>
Najdenovska, Elena, Yasser Alemán-Gómez, Giovanni Battistella, Maxime Descoteaux, Patric Hagmann, Sebastien Jacquemont, Philippe Maeder, Jean-Philippe Thiran, Eleonora Fornari, and Meritxell Bach Cuadra. 2018. “In-Vivo Probabilistic Atlas of Human Thalamic Nuclei Based on Diffusion-Weighted Magnetic Resonance Imaging.” Scientific Data 5 (1). Nature Publishing Group: 1–11. https://doi.org/10.1038/sdata.2018.270.
<p style="margin: 2px 0;"></p>
Pauli, Wolfgang M, Amanda N Nili, and J Michael Tyszka. 2018. “A High-Resolution Probabilistic in Vivo Atlas of Human Subcortical Brain Nuclei.” Scientific Data 5 (1). Nature Publishing Group: 1–13. https://doi.org/10.1038/sdata.2018.63.
<p style="margin: 2px 0;"></p>
Satterthwaite, Theodore D., Mark A. Elliott, Raphael T. Gerraty, Kosha Ruparel, James Loughead, Monica E. Calkins, Simon B. Eickhoff, et al. 2013. “An Improved Framework for Confound Regression and Filtering for Control of Motion Artifact in the Preprocessing of Resting-State Functional Connectivity Data.” NeuroImage 64 (January): 240–56. https://doi.org/10.1016/j.neuroimage.2012.08.052.
<p style="margin: 2px 0;"></p>
Schaefer, Alexander, Ru Kong, Evan M. Gordon, Timothy O. Laumann, Xi-Nian Zuo, Avram J. Holmes, Simon B. Eickhoff, and B. T. Thomas Yeo. 2018. “Local-Global Parcellation of the Human Cerebral Cortex from Intrinsic Functional Connectivity MRI.” Cerebral Cortex (New York, N.Y.: 1991) 28 (9): 3095–3114. https://doi.org/10.1093/cercor/bhx179.
<p style="margin: 2px 0;"></p>
Taylor, Paul A, and Ziad S Saad. 2013. “FATCAT:(An Efficient) Functional and Tractographic Connectivity Analysis Toolbox.” Brain Connectivity 3 (5). Mary Ann Liebert, Inc. 140 Huguenot Street, 3rd Floor New Rochelle, NY 10801 USA: 523–35.
<p style="margin: 2px 0;"></p>
Tian, Ye, Daniel S Margulies, Michael Breakspear, and Andrew Zalesky. 2020. “Topographic Organization of the Human Subcortex Unveiled with Functional Connectivity Gradients.” Nature Neuroscience 23 (11). Nature Publishing Group: 1421–32. https://doi.org/10.1038/s41593-020-00711-6.
<p style="margin: 2px 0;"></p>
Virtanen, Pauli, Ralf Gommers, Travis E. Oliphant, Matt Haberland, Tyler Reddy, David Cournapeau, Evgeni Burovski, et al. 2020. “SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python.” Nature Methods 17 (3): 261–72. https://doi.org/10.1038/s41592-019-0686-2.
<p style="margin: 2px 0;"></p>
Yarkoni, Tal, Christopher J Markiewicz, Alejandro de la Vega, Krzysztof J Gorgolewski, Taylor Salo, Yaroslav O Halchenko, Quinten McNamara, et al. 2019. “PyBIDS: Python Tools for Bids Datasets.” Journal of Open Source Software 4 (40). NIH Public Access.
<p style="margin: 2px 0;"></p>
Zhang, Bo, Fei Wang, Hao-Ming Dong, Xiao-Wei Jiang, Sheng-Nan Wei, Miao Chang, Zhi-Yang Yin, et al. 2019. “Surface-Based Regional Homogeneity in Bipolar Disorder: A Resting-State fMRI Study.” Psychiatry Research 278 (August): 199–204. https://doi.org/10.1016/j.psychres.2019.05.045.
<p style="margin: 2px 0;"></p>
Zou, Qi-Hong, Chao-Zhe Zhu, Yihong Yang, Xi-Nian Zuo, Xiang-Yu Long, Qing-Jiu Cao, Yu-Feng Wang, and Yu-Feng Zang. 2008. “An Improved Approach to Detection of Amplitude of Low-Frequency Fluctuation (ALFF) for Resting-State fMRI: Fractional ALFF.” Journal of Neuroscience Methods 172 (1): 137–41. https://doi.org/10.1016/j.jneumeth.2008.04.012.
</div>
</details>


<br>
Functional data were processed using **[XCP-D](https://xcp-d.readthedocs.io/en/latest/index.html)** with `--mode linc` flag (see more details [here](https://xcp-d.readthedocs.io/en/latest/workflows.html#linc-mode)).

Preprocessed BOLD data ([**fMRIPrep outputs**]({{ site.baseurl }}/docs/imaging/image_fmriprep/)) underwent nuisance regression following the removal of non-steady-state volumes. The data were then despiked, band-pass filtered, and smoothed. For each atlas (e.g., Glasser, Gordon, and multiple resolutions of the Schaefer parcellation), <span style="color: #7556b7;">parcellated time series</span> were extracted from the residual BOLD signal. From these, <span style="color: #7556b7;">pairwise functional connectivity (Pearson’s correlation)</span> was computed between parcels, along with <span style="color: #7556b7;">regional homogeneity</span> ([**ReHo**](https://xcp-d.readthedocs.io/en/latest/workflows.html#reho)), and <span style="color: #7556b7;">amplitude of low-frequency fluctuation</span> ([**ALFF**](https://xcp-d.readthedocs.io/en/latest/workflows.html#alff)).

<div class="alert alert-primary" role="alert">
  <strong>IMPORTANT:</strong> The exact <strong>XCP-D</strong> pipeline is documented in the <em>boilerplate</em> located at <code>&lt;xcpd_output&gt;/logs/CITATION.html</code>. If the data were processed with <a href="{{ site.baseurl }}/docs/imaging/image_babs/"><strong>BABS</strong></a> (i.e., were zipped), refer to <a href="{{ site.baseurl }}/docs/get_data#312-explore-the-data-structure"><strong>Get Data</strong></a> for details on unzipping <code>&lt;xcpd_output&gt;</code> to access the boilerplate file.
</div>


## Quality Control

XCP-D produces files for QC fMRI data:

<details style="background-color: #f0f0ff; border: 1px solid #d0d0ff; border-radius: 8px; padding: 15px; margin: 10px 0;">
<summary style="cursor: pointer; font-weight: bold; color: #4a4a8a;"><strong>File:</strong> <code>*linc_qc.tsv</code></summary>

<table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
<thead>
<tr style="background-color: #e8e8ff;">
<th style="border: 1px solid #d0d0ff; padding: 8px; text-align: left; font-weight: bold;">Metric</th>
<th style="border: 1px solid #d0d0ff; padding: 8px; text-align: left; font-weight: bold;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>mean_fd</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Mean framewise displacement</td>
</tr>
<tr style="background-color: #f8f8ff;">
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>mean_fd_post_censoring</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Mean framewise displacement after censoring</td>
</tr>
<tr>
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>mean_relative_rms</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Mean relative root mean square</td>
</tr>
<tr style="background-color: #f8f8ff;">
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>max_relative_rms</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Maximum relative root mean square</td>
</tr>
<tr>
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>mean_dvars_initial</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Mean DVARS before processing</td>
</tr>
<tr style="background-color: #f8f8ff;">
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>mean_dvars_final</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Mean DVARS after processing</td>
</tr>
<tr>
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>num_dummy_volumes</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Number of dummy volumes</td>
</tr>
<tr style="background-color: #f8f8ff;">
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>num_censored_volumes</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Number of censored volumes</td>
</tr>
<tr>
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>num_retained_volumes</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Number of retained volumes</td>
</tr>
<tr style="background-color: #f8f8ff;">
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>fd_dvars_correlation_initial</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Correlation between FD and DVARS before processing</td>
</tr>
<tr>
<td style="border: 1px solid #d0d0ff; padding: 8px;"><code>fd_dvars_correlation_final</code></td>
<td style="border: 1px solid #d0d0ff; padding: 8px;">Correlation between FD and DVARS after processing</td>
</tr>
</tbody>
</table>

</details>

<details style="background-color: #f0f0ff; border: 1px solid #d0d0ff; border-radius: 8px; padding: 15px; margin: 10px 0;">
<summary style="cursor: pointer; color: #4a4a8a;"><strong>File:</strong> <code>*_motion.json</code> (fMRIPrep confounds output)</summary>

<pre style="background-color: #f8f8ff; border: 1px solid #d0d0ff; border-radius: 4px; padding: 15px; overflow-x: auto; font-size: 14px; line-height: 1.4;">
{
  "Sources": [
    "bids:preprocessed:sub-NDARAC853CR6/ses-1/func/sub-NDARAC853CR6_ses-1_task-movieDM_acq-VARIANTPlumb_desc-confounds_timeseries.tsv"
  ],
  "framewise_displacement": {
    "Description": "Framewise displacement calculated according to Power et al. (2012).",
    "HeadRadius": 50.0,
    "Units": "mm"
  },
  "rmsd": {},
  "rot_x": {
    "Description": "Rotation about left-right axis. Also known as \"pitch\".",
    "Units": "rad"
  },
  "rot_y": {
    "Description": "Rotation about anterior-posterior axis. Also known as \"roll\".",
    "Units": "rad"
  },
  "rot_z": {
    "Description": "Rotation about superior-inferior axis. Also known as \"yaw\".",
    "Units": "rad"
  },
  "trans_x": {
    "Description": "Translation along left-right axis.",
    "Units": "mm"
  },
  "trans_y": {
    "Description": "Translation along anterior-posterior axis.",
    "Units": "mm"
  },
  "trans_z": {
    "Description": "Translation along superior-inferior axis.",
    "Units": "mm"
  }
}
</pre>

</details>

<br>
We recommend using a **median Framewise Displacement (FD) threshold of `> 0.2` for run-level exclusion**, as implemented in [the Reproducible Brain Chart study](https://doi.org/10.1101/2025.02.24.639850). Check the `XCP-D` section on the dataset-specific page (dataset-specific links listed [here]({{ site.baseurl }}/docs/datasets)) for the path to our recommended **XCP-D fMRI QC file**.

<div class="alert alert-warning" role="alert">
  <strong>⚠️ WARNING:</strong> Please note that our general recommendation is to use a run-level threshold of <strong>median FD > 0.2</strong>. However, depending on the characteristics of a given dataset, higher or lower thresholds may be more appropriate. To determine the most suitable threshold for a specific dataset (and assess the percentage of retained data), we encourage you to review the <strong>XCP-D fMRI QC file</strong> listed in the <code>XCP-D</code> section of the dataset-specific page. Dataset-specific links are listed <a href="{{ site.baseurl }}/docs/datasets">here</a>.
</div>